# Domain Enumeration

## domain enum, map trusts, relationships, privileges and various entities for the domain

### current domain

In powershell as a normal user:
```powershell
$ADClass = [System.DirectoryServices.ActiveDirctory.Domain]
$ADClass::GetCurrentDomain()
```
<br>

### built-in tools used for enum

#### Powerview
https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1

#### ActiveDirectory PowerShell module
https://docs.microsoft.com/en-us/powershell/module/addsadministration/?view=windowsserver2019-ps&viewFallbackFrom=win10-ps
```powershell
Import-Module .\Microsoft.ActiveDirectory.Management.dll
Import-Module .\ActiveDirectory\ActiveDirectory.psd1
```

#### current domain
```powershell
Get-NetDomain   # powerview

Get-ADDomain    # AD module
```

#### object of another domain
```powershell
Get-NetDomain -Domain domain_2.local    # powerview

Get-ADDomain -Identity domain_2.local   # AD module
```

#### domain SID for current domain
```powershell
Get-DomainSID              # powerview

(Get-ADDomain).DomainSID   # AD module
```

#### domain policy for current domain
```powershell
Get-DomainPolicy		     # powerview
(Get-DomainPolicy)."system access"   # powerview
```

#### domain policy for another domain
```powershell
(Get-DomainPolicy -domain domain_2.local)."system access"   # powerview
```

#### domain controllers for current domain 
```powershell
Get-NetDomainController   # powerview

Get-ADDomainController    # AD module
```

#### domain controllers for another domain
```powershell
Get-NetDomainController -Domain domain_2.local                # powerview

Get-ADDomainController -DomainName domain_2.local -Discover   # AD module
```

#### list of users in current domain
```powershell
Get-NetUser				     # powerview
Get-NetUser -Username someuser   

Get-ADUser -Filter * -Properties *          # AD module
Get-ADUser -Identity someuser -Properties *   
```

#### list all properties for users in current domain
```powershell
Get-UserProperty		         # powerview
Get-UserProperty -Properties pwdlastset

Get-ADUser -Filter * -Properties * | select -First 1 | Get-Member -Membertype *Property | select Name     # AD module
Get-ADUser -Filter * -Properties * | select name,@{expression={[datetime]::fromFileTime($_.pwdlastset)}}  
```

#### search a specific string in a user's attributes
often sysadmins would add valuable info to a user's description. example, the password for a shared user (helpdesk, support, domain account etc).

```powershell
Find-UserField -SearchField Description -SearchTerm "built"   # powerview

Get-ADUser -Filter 'Description -like "*built*"' -Properties Description | select name,Description   # AD module
```

#### list computers in cuurrent domain
```powershell
Get-NetComputer   # powerview
Get-NetComputer -OperatingSystem "*Server 2016*"
Get-NetComputer -Ping
Get-NetComputer -FullData

Get-ADComputer -Filter * | select Name   # AD module
Get-ADComputer -Filter 'OperatingSystem -like "*Server 2016*"' -Properties OperatingSystem | select Name,OperatingSystem
Get-ADComputer -Filter * -Properties DNSHostName | %{Test-Connection -Count 1 -ComputerName $_.DNSHostName}
Get-ADComputer -Filter * -Properties *
```

#### groups in current domain
```powershell
Get-NetGroup   # powerview
Get-NetGroup -Domain targetdomain
Get-NetGroup -FullData

Get-ADGroup -Filter * | select Name   # AD module
Get-ADGroup -Filter * -properties
```

#### search all groups containing a specific word
```powershell
Get-NetGroup *specific_word*   # powerview
Get-NetGroup -GroupName *specific_word*

Get-ADGroup -Filter 'Name -like "*admin*"' | select Name   # AD module
```

#### list all members of the domain admin group
```powershell
Get-NetGroupMember -GroupName "Domain Admins" -Recurse   # powerview

Get-ADGroupMember -Identify "Domain Admin" -Recursive   # AD module
```

#### group membership of a user
```powershell
Get-NetGroup -UserName "someuser"   # powerview

Get-ADPrincicalGroupMembership -Identity someuser   # AD module
``` 

#### all local groups on a machine
need admin rights on non-dc machines

```powershell
Get-NetLocalGroup -ComputerName compname.sub.somedomain.local -ListGroups
```

#### members of all local groups on machine
need admin rights on non-dc machines

```powershell
Get-NetLocalGroup -ComputerName compname.sub.somedomain.local -Recurse
```
 










































































